# TFMD: Time-Frequency Mode Decomposition

This repository contains the MATLAB implementation for the **Time-Frequency Mode Decomposition (TFMD)** method.

## Introduction

TFMD is a signal processing technique designed to decompose a non-stationary signal into its constituent oscillatory modes. The method operates by identifying and isolating high-energy regions in the signal's time-frequency representation, which is obtained using the Short-Time Fourier Transform (STFT).

## Methodology Flowchart

The core of the TFMD methodology is illustrated in the flowchart below. This process systematically identifies, separates, and reconstructs the intrinsic modes of a signal from its time-frequency plane.

<!-- FIX 1: Corrected image link syntax from [text](url) to ![alt text](url) -->
<!-- Make sure you have converted Flowchart.pdf to Flowchart.png and uploaded it to a 'figures' folder -->
![Flowchart of the proposed TFMD methodology](figures/Flowchart.png)

<!-- FIX 2: Re-formatted the caption to correctly render math formulas on GitHub -->
*Figure 1: Flowchart of the proposed TFMD methodology. The process starts with (a) the input signal $x[n]$, which is transformed by the STFT to yield (b) the complex coefficients $S[k,m]$ and their corresponding spectrogram $|S[k,m]|$. The (c) non-negative frequency portion of the spectrogram is then (d) smoothed to produce a smoothed spectrogram $\hat{S}[k',m]$, which highlights high-energy TF regions. (e) An initial binary mask $B_{\text{ini}}[k',m]$ is generated via adaptive thresholding. (f) Connected-component labeling (CCL) is applied to identify distinct regions of connected 1-valued pixels, assigning a unique label to each region in the labeled components $L[k',m]$. (g) These regions are isolated as candidate masks $B_{\text{cand}, i}[k',m]$. These masks are then (h) filtered by size to remove masks that may be generated by noise artifacts, yielding a set of filtered masks $B_{\text{filt}, i}[k',m]$. (i) The filtered masks are extended with frequency symmetry to create the final masks $B_{i}[k,m]$. These are used to (j) extract the masked TF component for each mode from the original STFT coefficients. (k) Finally, ISTFT reconstructs each masked TF component into a time-domain mode, and (l) these modes are summed to synthesize the final reconstructed signal $\hat{x}[n]$.*

## File Structure

-   `tfmd.m`: The core function that implements the Time-Frequency Mode Decomposition algorithm.
-   `test.m`: A comprehensive test suite that demonstrates how to use `tfmd.m` on various signals.
-   `generate_signal.m`: A script to generate sample signals for testing purposes.
-   `Flowchart.pdf`: The source PDF file containing the detailed methodology flowchart.

<!-- FIX 3: Updated "How to Use" section based on the provided test.m script -->
## How to Use

### 1. Run the Full Test Suite

The easiest way to see the algorithm in action is to run the complete test suite, which evaluates TFMD on 6 different synthetic signals.

```matlab
% This script will generate signals, apply TFMD, calculate performance,
% and create figures for each case.
test;
```

### 2. Step-by-Step Usage

For custom use, follow these steps, which mirror the logic in `test.m`:

#### Step 1: Generate or Load a Signal
First, obtain your signal and sampling frequency `fs`. You can use the provided function to generate a sample signal.

```matlab
fs = 1000; % Sampling frequency in Hz
case_idx = 1; % For example, the first signal case
signal_data = generate_signal(case_idx, fs);
input_signal = signal_data.clean;
```

#### Step 2: Define TFMD Parameters
The `tfmd` function requires an options struct to control its behavior. You can define it as follows:

```matlab
% Define TFMD parameters
tfmd_options = struct();
tfmd_options.window_length = 128;          % STFT window length
tfmd_options.win_type = 'gaussian';        % Window type ('gaussian' or 'hann')
tfmd_options.alpha = 2.5;                  % Shape parameter for Gaussian window
tfmd_options.overlap_ratio = 115/128;      % Overlap ratio (e.g., 115/128 ≈ 89.8%)
tfmd_options.threshold_factor = 2.0;       % Adaptive thresholding factor
tfmd_options.min_component_size = 10;      % Absolute minimum size (in pixels) for a component
```

#### Step 3: Apply TFMD
Call the `tfmd` function with the signal, sampling frequency, and options.

```matlab
[decomposed_modes, reconstructed_signal] = tfmd(input_signal, fs, tfmd_options);
```

#### Step 4: Analyze the Results
The function returns the decomposed modes as a cell array and the signal reconstructed from these modes.

```matlab
fprintf('Found %d modes.\n', length(decomposed_modes));

% Plot the first decomposed mode
figure;
plot(signal_data.t, decomposed_modes{1});
title('First Decomposed Mode');
xlabel('Time (s)');
ylabel('Amplitude');
```

## Requirements

-   **MATLAB**
-   **Signal Processing Toolbox™**: Required for `stft`, `istft`, and windowing functions.
-   **Image Processing Toolbox™**: Required for connected-component labeling (`bwlabel` or `bwconncomp`).

## Contributing

Contributions are welcome! Please feel free to submit a pull request or open an issue.

## License

Consider adding an open-source license to your project by creating a `LICENSE` file.
